# Kairos Project Roadmap and Next Steps

## Introduction

Kairos is an AI-driven internal platform that automates applicant evaluations by integrating a frontend Airtable extension for data collection with a backend MCP server for data enrichment (LinkedIn profiles, PDF resume extraction) and multi-axis scoring via LLMs.
Use this roadmap to track progress, capture context, and plan future development.

This document captures our current progress, in-progress work, and upcoming tasks for the Kairos applicant evaluation platform. Use this as a reference to continue development later.

---

## ‚úÖ Completed

- **Server logging standardized**  
  Migrated to centralized Python logging with a structured adapter; removed structlog usages; consistent masking and concise INFO/verbose DEBUG.
- **Frontend logging and logs split**  
  Use centralized `Logger`; Logs field now strips LinkedIn/PDF/Multi‚ÄëAxis blocks, which are written to their dedicated fields.
- **Multi‚ÄëAxis default + single‚Äëaxis behavior**  
  Default multi‚Äëaxis template is SPAR. When multi‚Äëaxis is OFF, generate single‚Äëaxis from SPAR‚Äôs first axis (General Promise).
- **PDF resume plugin reliability**  
  Fixed LLM fallback to pass provider API key; refined prompt (preserve UTF‚Äë8 diacritics, keep ‚ÄúPresent‚Äù, retain %, strict JSON, no hallucinations); added Unicode/percent normalization.
- **Evaluate flow polish**  
  Frontend prunes server payloads (no unnecessary fields); token refresh buffer increased to 5 minutes.

## ‚úÖ Completed (Today's Session)

- **UI fields verification**  
  Confirmed separate display fields for Logs, LinkedIn Data, PDF Resume Data, and Multi‚ÄëAxis scores.
- **Evaluate payload optimization**  
  Server receives only required fields; conditional enrichment/multi‚Äëaxis flags sent when needed.
- **Feature flag consolidation**  
  Verified flags are properly organized in Preset type; no redundant flags found.
- **Prompt system cleanup**  
  Replaced ACADEMIC_TEMPLATE references with SPAR_SINGLE_AXIS_TEMPLATE in frontend.
- **Documentation refresh**  
  Updated server README to reflect current API usage patterns.
- **Enrichment logs inclusion**  
  LinkedIn and PDF data fields now include enrichment logs alongside extracted data for better debugging.

## üîç Findings (Today's Session)

- **Duplicate writer/extractor implementations discovered**
  - There were two implementations responsible for composing and writing evaluation records and extracting enrichment data: a local implementation inside `front/lib/evaluateApplicants.ts` and a centralized implementation in `front/lib/evaluation/airtableWriter.ts` + `front/lib/evaluation/extractors.ts`.
  - Runtime was using the local implementation, so recent logging and extraction improvements added to the centralized modules were not visible.

- **Missing enrichment population symptom**
  - Full combined logs were being written to the Logs field, but dedicated enrichment columns (LinkedIn, PDF, Multi‚ÄëAxis) were not consistently populated because the centralized extractor code was not being invoked by the active code path.

- **Logging/UX improvements implemented**
  - Updated UI to show the server-fallback confirm at most once per batch (reduces spam).
  - Made request timeout and retry counts configurable via `globalConfig` keys: `serverRequestTimeout` (ms) and `serverMaxRetries` (count) with safer defaults (longer timeout to accommodate enrichment plugin calls).
  - Logs now include explicit JSON/stringified snippets for `recordData` and short snippets for each enrichment field to make visibility in DevTools reliable.
  - The Logs field is now written with the full combined logs (including enrichment blocks) while dedicated enrichment fields remain populated from extractors (copy, not move).

## ‚úÖ Actions taken (code changes)

- Added centralized extractor module: `front/lib/evaluation/extractors.ts` (contains PDF, LinkedIn, enrichment log, multi-axis extractors).
- Added centralized Airtable writer: `front/lib/evaluation/airtableWriter.ts` with richer logging and explicit enrichment-field population.
- Added per-batch fallback for server-failure prompt and globalConfig-based server timeout/retry tuning in `front/lib/getChatCompletion/server/index.ts`.
- Added debug snippets and stronger INFO-level logs to help trace extraction and Airtable writes.

## ‚ö†Ô∏è Outstanding work (immediate)

- **Consolidate writer usage (HIGH)**
  - Remove duplicated local `createEvaluationRecords` and extractor implementations from `front/lib/evaluateApplicants.ts` so the runtime always uses `front/lib/evaluation/airtableWriter.ts` and `front/lib/evaluation/extractors.ts`.
  - Ensure all call sites import and call the centralized `createEvaluationRecords` (or a thin wrapper) and remove any leftover compatibility hacks.
  - Manual validation: run single-applicant and small-batch evaluations verifying that centralized logs appear and dedicated enrichment fields populate.

- **Fallback extractor (optional short-term)**
  - Add a conservative fallback that copies the raw marker block into the dedicated field if the regex extractor fails but markers are present. This is a quick safety net while we tighten parsing.

- **UI settings for server tuning (nice to have)**
  - Add a small settings panel in the frontend to set `serverRequestTimeout` and `serverMaxRetries` via `globalConfig` (so admins can tune without code changes).

- **Test matrix**
  - Add manual tests to verify enrichment extraction for: (a) PDF only, (b) LinkedIn only, (c) both, (d) multi-axis scores present, and (e) large PDF payloads that may trigger truncation.


## üìå Pending Tasks

1. **Minor Cleanup**  
   - Review for any remaining academic template references in test files
   - Validate SPAR template is working correctly in both single and multi-axis modes

3. **Docs**  
   - Refresh `front/README.md`, `server/README.md`, and plugin docs to match current behavior and settings.

4. **PDF resume robustness (next iteration)**  
   - Add DEBUG normalization summary counters (optional) and broaden tests across varied PDFs.  
   - Light post‚Äëprocessor for common date formats and safe unit retention (already partially done).

5. **Performance**  
   - Validate concurrency settings; consider improved batching once core flows are stable.

6. **Automated tests (after manual validation)**  
   - Unit tests: multi‚Äëaxis score extraction, enrichment parsing, prompt building.  
   - Integration: end‚Äëto‚Äëend evaluation (front ‚Üí server ‚Üí Airtable).  
   - CI wiring.

7. **Security (deferred until everything else is ready)**  
   - Keep per‚Äërequest key behavior. Revisit transport hardening (e.g., encrypted API key transport) and scope enforcement once feature work settles.  
   - Ensure PDF fallback uses the provider/model/options passed by the frontend for all LLM calls.

## üõ† Frontend refactor TODO (short-term roadmap)

- **Batch 1 (do now)** ‚Äî Split large responsibilities in `front/lib/evaluateApplicants.ts`:
  - Move extractors (`extractLinkedinData`, `extractPdfResumeData`, `extractEnrichmentLogs`, `extractMultiAxisData`) to `front/lib/evaluation/extractors.ts`.
  - Move Airtable write logic (`createEvaluationRecords`, `setApplicantNameInResult`) to `front/lib/evaluation/airtableWriter.ts`.
  - Keep `evaluateApplicants.ts` as the orchestrator; import new modules. Preserve all `Logger.*` messages and behavior.
  - Manual validation: run the extension locally, execute sample evaluations, verify LinkedIn/PDF fields and logs.

- **Batch 2** ‚Äî Move server-evaluation client logic out of `evaluateItem` into `front/lib/evaluation/serverClient.ts` (or reuse `lib/getChatCompletion/server` helpers). Make `evaluateItem` delegate to that client.

- **Batch 3** ‚Äî Extract batching and precheck logic from `frontend/MainPage.tsx` into `front/lib/batching.ts` to keep `MainPage` primarily UI.

- **Lint & comment pass** ‚Äî Remove self-explanatory comments, keep design/why comments (retry rationale, token buffer), and standardize log verbosity later behind config.

- **Tests & validation** ‚Äî Prefer manual validation after each change. Add small unit tests for extractors/airtable writer later (optional now).

- **Commit policy** ‚Äî Make small per-file commits with compatibility wrappers where needed to avoid mass caller changes.

## üìö Server docs reading plan

Planned read order to produce `front/docs/server-usage.md`:

1. `server/README.md` ‚Äî overall server setup and deployment.
2. `server/src/api/llm/prompt_system/` ‚Äî templates, builder, and prompt flow.
3. `server/src/api/llm/providers/` and `server/src/core/llm/` ‚Äî provider integration and evaluation routing.
4. `server/src/core/plugin_system/` and `server/src/plugins/` ‚Äî PDF resume plugin and LinkedIn enrichment implementation.
5. Any `server/docs/` or README files under API folders for endpoint payloads and auth details.

Output goal: concise `front/docs/server-usage.md` containing:
- Quick start for server mode (config + auth)
- Example evaluate payloads (marked TODO until server structure is confirmed)
- Available server tools and flags (PDF resume parsing, LinkedIn enrichment)
- Reference links to `../server/README.md` and server API docs


---

**Notes**  
- We prioritize manual testing until core functionality is stable, then add automated tests.  
- Comments should focus on *why* code exists; remove redundant or ‚Äúwhat‚Äù comments.  
- Keep logs at appropriate levels: `ERROR`/`WARN` for failures, `INFO` for high-level operations, `DEBUG`/`TRACE` for detailed diagnostics.

---

## Project context (quick reference)
- Frontend Airtable extension with server‚Äëmode toggle; can enrich via LinkedIn and PDF; supports multi‚Äëaxis (SPAR) and single‚Äëaxis (derived from SPAR first axis).
- Backend FastAPI MCP server with LLM proxy/evaluation; plugins for LinkedIn and PDF; JWT auth with 60‚Äëmin access tokens and client‚Äëside cache refresh.
- Multi‚Äëaxis: SPAR is default; academic kept only as legacy template reference in code, not default.

## Next session checklist
- Verify UI fields display: Logs vs LinkedIn Data vs Resume Data vs Multi‚ÄëAxis.  
- Confirm evaluate payload contains only required fields in server mode.  
- Pick 2‚Äì3 additional PDFs and validate normalization/prompt rules.  
- Proceed to small refactors and docs refresh; defer security transport hardening to the end.

*Last updated: December 2024*